# useEffect èˆ‡è³‡æ–™æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰

 // 1ï¸âƒ£ é é¢è¼‰å…¥æ™‚ï¼Œå¾ localStorage è®€å–
  useEffect(() => {
    const stored = localStorage.getItem("todos");
    if (stored) {
      setTodos(JSON.parse(stored));
    }
  }, []);

  // 2ï¸âƒ£ æ¯æ¬¡ todos æ”¹è®Šï¼Œå¯«å› localStorage
  useEffect(() => {
    localStorage.setItem("todos", JSON.stringify(todos));
  }, [todos]);


# ğŸ§  useEffect é‡é»

### â‘  componentDidMount (åªè·‘ä¸€æ¬¡)

`useEffect(() => { // é é¢ç¬¬ä¸€æ¬¡è¼‰å…¥ }, []);` 

### â‘¡ componentDidUpdate (ä¾è³´é™£åˆ—)

`useEffect(() => { // todos æ”¹è®Šå°±è·‘ }, [todos]);`


# **API ä¸²æ¥ï¼ˆfetch å¾ä¼ºæœå™¨æŠ“è³‡æ–™ï¼‰**

é€™ä¸€èª²æœƒè®“ä½ å­¸æœƒï¼š

âœ” ç”¨ `fetch` å¾ API æ‹¿è³‡æ–™  
âœ” åœ¨ Next.js Client Component æˆ– Server Component ä½¿ç”¨  
âœ” é¡¯ç¤ºæŠ“åˆ°çš„è³‡æ–™

âœ… Step 1ï¼šå»ºç«‹ API Routeï¼ˆNext.jsï¼‰

`app/api/todos/route.ts`

    import { NextResponse } from "next/server";
    
    let todos: string[] = ["å­¸ç¿’ React", "å­¸ç¿’ Next.js"];
    
    export async function GET() {
      return NextResponse.json(todos);
    }
    
    export async function POST(req: Request) {
      const { text } = await req.json();
      todos.push(text);
      return NextResponse.json({ message: "æ–°å¢æˆåŠŸ" });
    }

âœ… Step 2ï¼šClient Component æŠ“è³‡æ–™

`app/TodoFetcher.tsx`

    "use client";
    import { useState, useEffect } from "react";
    
    export default function TodoFetcher() {
      const [todos, setTodos] = useState<string[]>([]);
      const [loading, setLoading] = useState(true);
    
      // 1ï¸âƒ£ é é¢è¼‰å…¥æ™‚æŠ“è³‡æ–™
      useEffect(() => {
        fetch("/api/todos")
          .then((res) => res.json())
          .then((data) => {
            setTodos(data);
            setLoading(false);
          });
      }, []);
    
      if (loading) return <p>Loading...</p>;
    
      return (
        <ul>
          {todos.map((t, i) => (
            <li key={i}>{t}</li>
          ))}
        </ul>
      );
    }

âœ… Step 3ï¼špage.tsx ä½¿ç”¨

    import TodoFetcher from "./TodoFetcher";
    
    export default function Home() {
      return (
        <div>
          <h1>Todo List from API</h1>
          <TodoFetcher />
        </div>
      );
    }

# ğŸ§  React/Next.js API å°æŠ€å·§

-   **Client Component** â†’ ç”¨ `useEffect` fetch
    
-   **Server Component** â†’ ç›´æ¥ç”¨ async fetchï¼Œç„¡éœ€ useEffect
    
-   **API route** â†’ Next.js å…§å»ºè·¯ç”± `/api/...`ï¼Œå¾ˆé©åˆç·´ç¿’


# ğŸ§± åŸºæœ¬æ¦‚å¿µ

åœ¨ **Next.js App Router API Route** ä¸­ï¼Œæ¯å€‹æª”æ¡ˆéƒ½æ˜¯ä¸€å€‹ endpointï¼Œä¾‹å¦‚ï¼š

`app/api/todos/route.ts` 

é€™å€‹æª”æ¡ˆæœƒå°æ‡‰åˆ°ï¼š

`/api/todos` 

Next.js æœƒè‡ªå‹•æª¢æŸ¥æª”æ¡ˆè£¡çš„å°å‡ºå‡½å¼ï¼š

    export async function GET(req: Request) { ... }
    export async function POST(req: Request) { ... }
    export async function PUT(req: Request) { ... }
    export async function DELETE(req: Request) { ... }


Next.js æœƒè‡ªå‹•æŠŠ **ç€è¦½å™¨æˆ–å‰ç«¯çš„ HTTP è«‹æ±‚æ–¹æ³•** å°æ‡‰åˆ°ç›¸å°æ‡‰çš„å‡½å¼ã€‚

----------

# ğŸ”‘ æ ¸å¿ƒåŸå‰‡

HTTP æ–¹æ³•

å°æ‡‰å‡½å¼

èªªæ˜

GET

`export function GET(req)`

å–å¾—è³‡æ–™

POST

`export function POST(req)`

æ–°å¢è³‡æ–™

PUT

`export function PUT(req)`

æ›´æ–°è³‡æ–™

DELETE

`export function DELETE(req)`

åˆªé™¤è³‡æ–™

> ä½ ä¸éœ€è¦è‡ªå·±åœ¨å‡½å¼è£¡åˆ¤æ–· `req.method`ï¼ŒNext.js å·²ç¶“å¹«ä½ åšäº†ã€‚
